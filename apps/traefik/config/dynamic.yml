# Traefik static configuration for routing to services on other VMs
# This file defines routes to services running on separate VMs
# Replace PI_HOLE_VM_IP with the actual IP address of your pi-hole VM

http:
  routers:
    pihole:
      rule: "Host(`pihole.local`) || Host(`pihole.yourdomain.com`) || Host(`pihole`)"
      entryPoints:
        - web
      service: pihole-service

    # Portainer routing configuration
    # Routes portainer.home domain to Portainer instance
    portainer:
      rule: "Host(`portainer.home`)"
      entryPoints:
        - web
      service: portainer-service

  services:
    pihole-service:
      loadBalancer:
        servers:
          - url: "http://192.168.0.104:80"
        # Pass through the Host header to pi-hole
        passHostHeader: true

    # Portainer service configuration
    # Backend connects to HTTPS Portainer with SSL verification disabled
    portainer-service:
      loadBalancer:
        servers:
          - url: "https://192.168.0.104:9443"
        # Use custom transport to handle HTTPS backend with self-signed certificates
        serversTransport: portainer-transport

  # Server transports configuration for handling SSL/TLS connections to backends
  serversTransports:
    # Transport configuration for Portainer HTTPS backend
    # Disables SSL verification to handle self-signed certificates
    portainer-transport:
      insecureSkipVerify: true

